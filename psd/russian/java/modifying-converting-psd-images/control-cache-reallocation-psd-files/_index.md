---
title: Перераспределение кэша управления в файлах PSD
linktitle: Перераспределение кэша управления в файлах PSD
second_title: Aspose.PSD Java API
description: Управляйте перераспределением кэша в PSD-файлах с помощью Aspose.PSD для Java. Узнайте, как эффективно оптимизировать память и обработку файлов — идеально для разработчиков.
weight: 22
url: /ru/java/modifying-converting-psd-images/control-cache-reallocation-psd-files/
---

{{< blocks/products/pf/main-wrap-class >}}
{{< blocks/products/pf/main-container >}}
{{< blocks/products/pf/tutorial-page-section >}}

# Перераспределение кэша управления в файлах PSD

## Введение
При программной работе с изображениями и файлами Photoshop эффективность является ключевым фактором. Aspose.PSD для Java предлагает надежные функции для беспрепятственного управления и манипулирования PSD-файлами. Одним из фундаментальных аспектов оптимизации производительности является контроль перераспределения кэша. Управление кэшем помогает поддерживать баланс между использованием памяти и диска, обеспечивая бесперебойную работу вашего приложения без неожиданных сбоев или замедлений. 
## Предварительные условия
Прежде чем мы перейдем к кодированию, вам необходимо убедиться в нескольких вещах, чтобы все работало гладко:
1. Комплект разработки Java (JDK): убедитесь, что на вашем компьютере установлен JDK. Вы можете скачать его с[сайт Oracle](https://www.oracle.com/java/technologies/javase-jdk11-downloads.html).
2. Aspose.PSD для Java: вам необходимо загрузить библиотеку Aspose.PSD. Вы можете найти последний выпуск[здесь](https://releases.aspose.com/psd/java/).
3. Настройка IDE. Интегрированная среда разработки (IDE), такая как IntelliJ IDEA или Eclipse, облегчит вам управление вашим кодом.
4. Базовое понимание Java. Знакомство с программированием на Java поможет вам лучше понять концепции и фрагменты кода.
5.  Лицензия Aspose (необязательно): если вы хотите удалить водяные знаки и получить полную функциональность, рассмотрите возможность приобретения лицензии.[здесь](https://purchase.aspose.com/buy) или попробуйте бесплатную пробную версию[здесь](https://releases.aspose.com/).
## Импортировать пакеты
Прежде чем мы начнем писать код, давайте убедимся, что у нас импортированы необходимые пакеты. Ниже приведен краткий список того, что следует включить в начало вашего Java-файла:
```java
import com.aspose.psd.Cache;
import com.aspose.psd.CacheType;
import com.aspose.psd.Color;
import com.aspose.psd.ColorPalette;
import com.aspose.psd.Image;
import com.aspose.psd.RasterImage;
import com.aspose.psd.imageoptions.GifOptions;
import com.aspose.psd.imageoptions.PsdOptions;
import com.aspose.psd.sources.StreamSource;
import com.aspose.psd.system.io.MemoryStream;
```
## Шаг 1. Настройка каталога данных
Прежде всего, вам нужно настроить каталог, в котором вы хотите хранить файлы кэша. Это важно для эффективного управления кэшем.
```java
String dataDir = "Your Document Directory";
Cache.setCacheFolder(dataDir);
```

- String dataDir: определите каталог для кэша документов.
- Cache.setCacheFolder(dataDir): этот метод устанавливает папку кэша в указанный каталог. Любой кеш, созданный Aspose, теперь будет храниться здесь, а не во временном каталоге по умолчанию.
## Шаг 2. Настройка кэша на диск
Далее мы укажем, что хотим, чтобы наш кеш хранился только на диске. Это особенно полезно, если ваше приложение использует большие файлы и вы хотите, чтобы память оставалась свободной.
```java
Cache.setCacheType(CacheType.CacheOnDiskOnly);
```

- Cache.setCacheType(CacheType.CacheOnDiskOnly): этот параметр гарантирует, что кэш не будет храниться в памяти, что полезно для обработки больших файлов PSD без использования слишком большого количества оперативной памяти.
## Шаг 3. Установка максимального размера диска и кэша памяти
Теперь давайте ограничим размеры нашего кэша. Это очень важно, поскольку неограниченный кэш может привести к проблемам с производительностью.
```java
Cache.setMaxDiskSpaceForCache(1073741824); // 1 гигабайт
Cache.setMaxMemoryForCache(1073741824); // 1 гигабайт
```

- Cache.setMaxDiskSpaceForCache(1073741824): устанавливает ограничение на размер кэша на диске в 1 ГБ. Вы можете настроить этот размер в зависимости от ваших потребностей.
- Cache.setMaxMemoryForCache(1073741824): аналогичным образом ограничивается кэш в памяти, гарантируя, что ваше приложение не будет использовать чрезмерную память.
## Шаг 4. Управление стратегией перераспределения кэша
Управление перераспределением кэша имеет важное значение для поддержания производительности. Вот как вы можете это настроить.
```java
Cache.setExactReallocateOnly(false);
```

- Cache.setExactReallocateOnly(false): если установлено значение false, это позволяет Aspose более гибко управлять перераспределением кэша, что может привести к повышению производительности.
## Шаг 5. Проверьте размер выделенного кэша
Этот шаг предназначен для мониторинга того, сколько байт в настоящее время выделено для кэша в памяти или на диске. Давайте реализуем это:
```java
long l1 = Cache.getAllocatedDiskBytesCount();
long l2 = Cache.getAllocatedMemoryBytesCount();
```

- long l1: хранит количество байтов, выделенных на диске.
- long l2: хранит количество байтов, выделенных в памяти. 
Вы можете проверить эти значения в любое время, чтобы убедиться, что ваше приложение управляет использованием памяти и диска должным образом.
## Шаг 6. Создание PSD-изображения
Теперь, когда у нас настроены конфигурации кэша, давайте создадим простое PSD-изображение.
```java
PsdOptions options = new PsdOptions();
Color[] color = { Color.getRed(), Color.getBlue(), Color.getBlack(), Color.getWhite() };
options.setPalette(new ColorPalette(color));
options.setSource(new StreamSource(new ByteArrayInputStream(new byte[0])));
RasterImage image = (RasterImage) Image.create(options, 100, 100);
```

- Параметры PsdOptions: этот объект позволяет указать параметры при создании изображения Photoshop.
- Цвет[] color: Массив, содержащий цвета, которые будут использоваться в палитре изображения.
## Шаг 7. Сохранение пиксельных данных в изображение
Теперь давайте заполним наше изображение данными пикселей и сохраним его.
```java
Color[] pixels = new Color[10000];
for (int i = 0; i < pixels.length; i++) {
    pixels[i] = Color.getWhite();
}
image.savePixels(image.getBounds(), pixels);
```

- Цвет[] пикселей: это массив цветных объектов. Здесь мы заполняем его белыми пикселями.
- image.savePixels(image.getBounds(), пикселей): этот метод сохраняет данные пикселей в изображении. Он обновляет изображение цветами, которые мы определили.
## Шаг 8. Мониторинг выделенного кэша после создания образа
После создания образа рекомендуется еще раз проверить, сколько байт выделено для кэша.
```java
long diskBytes = Cache.getAllocatedDiskBytesCount();
long memoryBytes = Cache.getAllocatedMemoryBytesCount();
```

- long diskBytes: фиксирует текущее распределение на диске после создания образа.
- long MemoryBytes: фиксирует текущее распределение в памяти. 
Этот шаг поможет вам определить, какой объем кэша используется после ваших операций.
## Шаг 9. Проверьте правильность утилизации
Наконец, очень важно убедиться, что все объекты Aspose.PSD были удалены правильно, чтобы избежать утечек памяти.
```java
l1 = Cache.getAllocatedDiskBytesCount();
l2 = Cache.getAllocatedMemoryBytesCount();
```

- l1 и l2: эти переменные помогут вам проверить окончательное распределение. Если они не равны нулю, это означает, что некоторые объекты не были удалены должным образом.
## Заключение
Управление перераспределением кэша в Aspose.PSD для Java может существенно повлиять на производительность вашего приложения. Следуя шагам, описанным выше, вы сможете эффективно управлять кешем, минимизировать использование памяти и эффективно создавать красивые PSD-файлы. Используйте эти методы и наблюдайте, как ваши приложения развиваются с оптимальной производительностью!
## Часто задаваемые вопросы
### Что такое Aspose.PSD?
Aspose.PSD — это библиотека для разработчиков .NET и Java, позволяющая программно создавать, манипулировать и конвертировать файлы Photoshop (PSD).
### Как проверить размер выделенного кэша?
 Используйте такие методы, как`Cache.getAllocatedDiskBytesCount()` и`Cache.getAllocatedMemoryBytesCount()` для мониторинга текущего использования кэша.
### Могу ли я установить собственный каталог для кэша?
 Да, вы можете указать другой каталог, используя`Cache.setCacheFolder("Your Directory Path")`.
### Можно ли использовать Aspose.PSD бесплатно?
Aspose.PSD — платная библиотека, но вы можете начать с бесплатной пробной версии, доступной на их сайте.[веб-сайт](https://releases.aspose.com/).
### Что произойдет, если я не утилизирую объекты?
Неудаление объектов может привести к утечкам памяти, в результате чего ваше приложение будет использовать больше ресурсов, чем необходимо.
{{< /blocks/products/pf/tutorial-page-section >}}

{{< /blocks/products/pf/main-container >}}
{{< /blocks/products/pf/main-wrap-class >}}

{{< blocks/products/products-backtop-button >}}
